
// nextflow flags
nextflow.enable.moduleBinaries = true

// workflow marapeters
params {
    // inputs
    sample_table = "/lustre/scratch127/cellgen/cellgeni/aljes/atac-pipeline/data/sample_table_filt.csv"
    celltype_annotation = "/lustre/scratch127/cellgen/cellgeni/aljes/atac-pipeline/data/celltype_annotation.csv"
    chromsizes = "/lustre/scratch127/cellgen/cellgeni/aljes/atac-pipeline/data/hg38.chrom.sizes"
    blacklist = "/lustre/scratch126/cellgen/team205/lm25/regGen/data/references/hg38-blacklist.v2.bed"
}

process {
    container = '/nfs/cellgeni/singularity/images/scenicplus-fa55dae.sif'
    withName: 'PYCISTOPIC:makePseudobulk' {
        cpus = 8
        memory = 100.GB
        queue = 'normal'
        maxRetries = 5
        time = 2.hours
    }
    withName: 'PYCISTOPIC:peakCalling' {
        cpus = 8
        memory = 8.GB
        queue = 'normal'
        maxRetries = 5
    }
    withName: 'PYCISTOPIC:inferConsensus' {
        cpus = 8
        memory = 8.GB
        queue = 'normal'
    }
}

singularity {
    enabled = true
    autoMounts = true
    runOptions  = '-B /lustre,/nfs'
}

executor {
    name = 'lsf'
    perJobMemLimit = true
}